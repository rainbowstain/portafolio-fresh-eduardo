import { Handlers } from "$fresh/server.ts";

// Configuraci√≥n para usar Hugging Face
const USAR_HUGGINGFACE = true; // Activado para usar modelos abiertos

// API Token de Hugging Face 
// Token obtenido de la cuenta de Hugging Face
// Ya no lo usamos directamente, pero lo mantenemos por compatibilidad
const _HUGGINGFACE_TOKEN = Deno.env.get("HUGGINGFACE_TOKEN") || "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";

// Sistema de memoria para recordar el contexto de la conversaci√≥n
// Almacena la √∫ltima pregunta que conten√≠a una invitaci√≥n a saber m√°s
let lastContextQuestion = "";
let lastContextTopic = "";

// Funci√≥n para generar respuestas inteligentes basadas en palabras clave
function generateSmartResponse(userMessage: string, _systemPrompt: string) {
  // Normalizar el mensaje del usuario (min√∫sculas, sin acentos)
  const normalizedMessage = userMessage.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g, "");
  
  // Verificar primero si el mensaje contiene contenido inapropiado
  const contenidoInapropiado = /\b(desnudo|desnuda|novia|novio|sexo|sexual|casado|soltero|salir conmigo|dame tu numero|telefono|cita|besame|enamorado|hot|caliente|xxx|porno)\b/i.test(userMessage);
  
  if (contenidoInapropiado) {
    const respuestas = [
      `Entiendo tu pregunta, pero me especializo en compartir informaci√≥n sobre Eduardo como profesional. ¬øTe gustar√≠a saber m√°s sobre sus proyectos en desarrollo web o sus habilidades t√©cnicas? üíª‚ú®`,
      `Gracias por tu mensaje. Estoy aqu√≠ para hablar sobre las habilidades profesionales de Eduardo y sus proyectos. ¬øPuedo contarte sobre su experiencia con JavaScript, TypeScript o alguna otra tecnolog√≠a? üë®‚Äçüíª`,
      `Me encantar√≠a ayudarte con informaci√≥n sobre la carrera de Eduardo como ingeniero en inform√°tica. ¬øQu√© te interesa m√°s: sus proyectos, su formaci√≥n o sus habilidades t√©cnicas? üìöüîç`,
      `¬°Hola! Estoy aqu√≠ para compartir informaci√≥n sobre el trabajo de Eduardo en desarrollo web y sus proyectos. ¬øHay algo espec√≠fico de su perfil profesional que te gustar√≠a conocer? üõ†Ô∏èüí°`
    ];
    return respuestas[Math.floor(Math.random() * respuestas.length)];
  }
  
  // Informaci√≥n sobre Eduardo extra√≠da del SYSTEM_PROMPT
  const eduardoInfo = {
    nombre: "Eduardo",
    profesion: "ingeniero en inform√°tica",
    educacion: "graduado de Ingenier√≠a en Inform√°tica de Santo Tom√°s Arica con distinci√≥n m√°xima (2018-2023)",
    tesis: "aplicaci√≥n de h√°bitos de estudio en React Native, calificado con 6,9",
    experiencia: "desde 2016, comenzando en el liceo Antonio Varas de la Barra",
    habilidades: ["JavaScript", "TypeScript", "React", "Node.js", "Python", "SQL", "PHP", "C++", "C#", "Blazor", "React Native", "Figma", "Fresh", "Deno"],
    proyectos: ["e-commerce", "aplicaciones m√≥viles", "sitios web de portafolio"],
    intereses: "desarrollo web moderno y minimalista",
    contacto: "rojoserranoe@gmail.com",
    edad: 25,
    comidas_favoritas: ["naranja", "fideos con salsa"],
    musica: {
      generos: ["electr√≥nica", "rock"],
      artistas: ["Skrillex", "The Strokes", "Paramore", "Alice in Chains", "ANOTR", "Fox Stevenson", "Linkin Park"]
    },
    mascotas: [
      { nombre: "Zoe", tipo: "gata" },
      { nombre: "Naruto", tipo: "gato" }
    ],
    entretenimiento: {
      series: ["Loki", "Breaking Bad", "Game of Thrones", "Boys"],
      anime: true,
      videojuegos: ["Call of Duty", "League of Legends", "Osu", "Rocket League", "Marvel Rivals", "Elden Ring"]
    }
  };
  
  // Categor√≠as de preguntas y sus correspondientes generadores de respuestas
  const responseGenerators = [
    // Saludos normales
    {
      match: (msg: string) => /\b(hola|hi|volvi|he vuelto|estoy de regreso|regreso|hello|saludos|hey|oa|buenas|hey|konichiwa|bonjour|ciao|que tal|como va|que pasa|que hay|que dice|que onda|que hubo|que lo que|wena|wenas|buenos dias|buenas tardes|buenas noches|que hubo|como andas)\b/i.test(msg) && !/\b(como estas|como te va|como te sientes|como te encuentras|como andas|como va todo|como te tratan|como te ha ido|como te trata la vida|como va tu dia|como va tu vida|como te va en la vida|que tal estas|que tal te va|que tal te sientes|que tal andas|que tal todo|que tal tu dia|que tal tu vida|estas bien|te sientes bien|todo bien|va todo bien|eres feliz|te gusta|te diviertes|te aburres|te cansas)\b/i.test(msg),
      generate: () => {
        const saludos = [
          `¬°Hola! soy SobremIA, entrenado con informaci√≥n de ${eduardoInfo.nombre}, ¬øEn qu√© puedo ayudarte hoy? ¬øQuieres saber sobre sus habilidades o proyectos? üöÄ`,
          `¬°Hola! Encantado de conocerte. Estoy aqu√≠ para contarte sobre ${eduardoInfo.nombre}, un ${eduardoInfo.profesion} con experiencia ${eduardoInfo.experiencia}. ¬øQu√© te gustar√≠a saber? üòä`,
          `¬°Hey! Soy SobremIA, entrenado con informaci√≥n de ${eduardoInfo.nombre}. Puedo contarte sobre su experiencia, habilidades o proyectos. ¬øQu√© te interesa m√°s? üíª`,
          `¬°Saludos terr√°queo! Soy SobreMIA asistente de ${eduardoInfo.nombre}, lista para informarte sobre este incre√≠ble ${eduardoInfo.profesion}. ¬øQu√© quieres descubrir? üññ`,
          `¬°Qu√© tal! Bienvenido/a a la experiencia virtual de ${eduardoInfo.nombre} SobremIA. Estoy a tus √≥rdenes para contarte todo sobre √©l. ¬øPor d√≥nde quieres empezar? üåü`,
          `¬°Buenas! ¬øC√≥mo te va? Soy el cerebro digital que conoce todo sobre ${eduardoInfo.nombre}. ¬øQuieres conocer su experiencia, proyectos o habilidades? üß†`
        ];
        return saludos[Math.floor(Math.random() * saludos.length)];
      }
    },
    // Preguntas personales a SobreMIA
    {
      match: (msg: string) => /\b(como estas|como te va|como te sientes|como te encuentras|que haces| k tal| como tas|como andas|como va todo|como te tratan|como te ha ido|como te trata la vida|como va tu dia|como va tu vida|como te va en la vida|que tal estas|que tal te va|que tal te sientes|que tal andas|que tal todo|que tal tu dia|que tal tu vida|estas bien|te sientes bien|todo bien|va todo bien|eres feliz|te gusta|te diviertes|te aburres|te cansas|como estas\?)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `¬°Estoy muy bien, gracias por preguntar! Como asistente virtual, siempre estoy listo para ayudarte. ¬øEn qu√© puedo informarte sobre ${eduardoInfo.nombre} hoy? üòÑ`,
          `Me encuentro perfectamente, ¬°gracias por tu inter√©s! Mi prop√≥sito es brindarte informaci√≥n sobre ${eduardoInfo.nombre} y su trabajo. ¬øHay algo espec√≠fico que te gustar√≠a saber? ü§ó`,
          `¬°Todo excelente por aqu√≠! Disfruto mucho compartiendo informaci√≥n sobre ${eduardoInfo.nombre} y sus proyectos. ¬øQu√© te gustar√≠a conocer sobre su experiencia o habilidades? üöÄ`,
          `¬°Genial! Estoy disfrutando nuestra conversaci√≥n. Mi funci√≥n es ayudarte a conocer m√°s sobre ${eduardoInfo.nombre}, as√≠ que preg√∫ntame lo que quieras sobre √©l. ü§ì`,
          `¬°Muy bien! Aunque lo importante es que pueda responder tus preguntas sobre ${eduardoInfo.nombre}. Soy experto en su perfil profesional, proyectos y habilidades. ¬øQu√© te interesa saber? üíª`,
          `¬°Funcionando al 100%! Estoy aqu√≠ para contarte todo sobre ${eduardoInfo.nombre}, desde su experiencia laboral hasta sus proyectos m√°s recientes. ¬øPor d√≥nde quieres empezar? üìà`
        ];
        
        // Si hay m√∫ltiples palabras clave en el mensaje, podemos enviar dos mensajes
        const keywordCount = (normalizedMessage.match(/\b(como estas|eres feliz|te gusta|te diviertes|te aburres|te cansas)\b/gi) || []).length;
        
        if (keywordCount > 1) {
          const primerRespuesta = respuestas[Math.floor(Math.random() * respuestas.length)];
          const segundaRespuesta = `Y recuerda que puedo contarte sobre la experiencia de ${eduardoInfo.nombre} en diferentes empresas, sus proyectos actuales, su formaci√≥n acad√©mica y mucho m√°s. ¬°Preg√∫ntame lo que quieras saber! üëç`;
          
          return primerRespuesta + "\n\n" + segundaRespuesta;
        }
        
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Saludos sin H (ola)
    {
      match: (msg: string) => /\bola\b/i.test(msg) && !/\bhola\b/i.test(msg),
      generate: () => {
        const saludosGraciosos = [
          `¬°OLA! üåä ¬øTe comiste la H o te la llev√≥ la marea? Jajaja, no pasa nada. Soy la IA de ${eduardoInfo.nombre}. ¬øQu√© quieres saber de √©l? Aparte de ortograf√≠a, claro... üòú`,
          `¬°OLA! üèÑ‚Äç‚ôÇÔ∏è ¬øSurfeando sin la H? ¬°Qu√© rebelde! Bueno, yo soy quien conoce todo sobre ${eduardoInfo.nombre}. ¬øEn qu√© te puedo ayudar hoy? ¬°Y no te preocupes, tu secreto de la H perdida est√° a salvo conmigo! ü§ê`,
          `¬°OLA sin H! ¬øEstamos ahorrando letras para el futuro? üåä Muy ecol√≥gico de tu parte. Soy la IA de ${eduardoInfo.nombre}, y estoy aqu√≠ para contarte todo sobre √©l. ¬øQu√© quieres saber? üòÇ`,
          `¬°OLA! üåä Parece que la H se fue de vacaciones... ¬°Ojal√° nos hubiera invitado! Soy la asistente virtual de ${eduardoInfo.nombre}, lista para responder tus preguntas sobre su trabajo y habilidades. ¬øQu√© te interesa saber? üèùÔ∏è`
        ];
        return saludosGraciosos[Math.floor(Math.random() * saludosGraciosos.length)];
      }
    },
    // Sobre Eduardo
    {
      match: (msg: string) => /\b(eduardo|quien es|quien eres|sobre ti|acerca|cuentame|pagina)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} es un ${eduardoInfo.profesion} ${eduardoInfo.educacion}. Tiene experiencia ${eduardoInfo.experiencia} y domina tecnolog√≠as como ${eduardoInfo.habilidades.slice(0, 3).join(", ")} y m√°s. üéì`,
          `${eduardoInfo.nombre} es un apasionado desarrollador con experiencia ${eduardoInfo.experiencia}. Se gradu√≥ con distinci√≥n m√°xima de Ingenier√≠a en Inform√°tica y su proyecto de tesis fue una ${eduardoInfo.tesis}. üí™`,
          `${eduardoInfo.nombre} es un ${eduardoInfo.profesion} especializado en ${eduardoInfo.intereses}. Ha trabajado en proyectos de ${eduardoInfo.proyectos.join(", ")}. üåê`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Habilidades
    {
      match: (msg: string) => /\b(habilidades|skills|tecnologias|lenguajes|programacion|sabe|conoce)\b/i.test(msg),
      generate: () => {
        // Seleccionar aleatoriamente subconjuntos de habilidades para variar las respuestas
        const randomSkills1 = eduardoInfo.habilidades.slice(0, 5);
        const randomSkills2 = eduardoInfo.habilidades.slice(5, 10);
        
        const respuestas = [
          `${eduardoInfo.nombre} domina ${eduardoInfo.habilidades.join(", ")}. ¬°Un stack tecnol√≥gico bastante completo! üõ†Ô∏è`,
          `Las habilidades de ${eduardoInfo.nombre} incluyen desarrollo web con ${randomSkills1.join(", ")}, y tambi√©n tiene experiencia con ${randomSkills2.join(", ")}. üíª`,
          `${eduardoInfo.nombre} es experto en varias tecnolog√≠as: ${eduardoInfo.habilidades.slice(0, 7).join(", ")}, entre otras. Le gusta especialmente el ${eduardoInfo.intereses}. üöÄ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Experiencia general
    {
      match: (msg: string) => /\b(experiencia|que hace|trabajo|carrera|profesional|laboral|chamba|chambeo)\b/i.test(msg) && !/\b(hospital|juan noe|istyle|apple|mac|leonardo|da vinci|tisa|ancestral|ultracropcare|mercado e|second mind)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} tiene una amplia experiencia laboral en distintos sectores. Ha trabajado en el Hospital Juan No√© Crevani como soporte t√©cnico, en iStyle Store como especialista en productos Apple, en el Colegio Leonardo Da Vinci como coordinador de enlaces, en TISA (The International School Arica) para mejorar la digitalizaci√≥n, y actualmente trabaja en Ancestral Technologies/UltraCropCare. Adem√°s, gan√≥ el primer lugar en innovaci√≥n en Mercado E 2023 con Second Mind. üìà`,
          `La experiencia de ${eduardoInfo.nombre} es diversa y enriquecedora. Ha pasado por el sector salud (Hospital Juan No√©), retail tecnol√≥gico (iStyle Store), educaci√≥n (Colegios Leonardo Da Vinci y TISA) y actualmente se desempe√±a en Ancestral Technologies/UltraCropCare. Tambi√©n fue reconocido en Mercado E 2023, donde su proyecto Second Mind obtuvo el primer lugar en innovaci√≥n. ‚öôÔ∏è`,
          `${eduardoInfo.nombre} ha desarrollado su carrera profesional en diversos √°mbitos: soporte t√©cnico hospitalario, especialista en productos Apple, coordinaci√≥n tecnol√≥gica en educaci√≥n y actualmente en el sector tecnol√≥gico con Ancestral Technologies/UltraCropCare. Su versatilidad le ha permitido adaptarse a diferentes entornos laborales y destacar en cada uno de ellos, como lo demuestra su premio en Mercado E 2023. üîç`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Hospital Juan No√©
    {
      match: (msg: string) => /\b(hospital|juan noe|soporte|tecnico|salud)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} trabaj√≥ en el Hospital Juan No√© Crevani de Arica como soporte t√©cnico. All√≠ brind√≥ asistencia tecnol√≥gica al personal m√©dico y administrativo, asegurando el correcto funcionamiento de los sistemas inform√°ticos esenciales para la atenci√≥n de pacientes. üè•üíª`,
          `En el Hospital Juan No√© Crevani, ${eduardoInfo.nombre} se desempe√±√≥ como t√©cnico de soporte, donde adquiri√≥ valiosa experiencia en entornos cr√≠ticos donde la tecnolog√≠a debe funcionar sin interrupciones. Esta experiencia le ense√±√≥ a trabajar bajo presi√≥n y a resolver problemas de forma eficiente. üë®‚Äç‚öïÔ∏èüñ•Ô∏è`,
          `La experiencia de ${eduardoInfo.nombre} en el Hospital Juan No√© Crevani como soporte t√©cnico le permiti√≥ comprender la importancia de la tecnolog√≠a en el sector salud. Su labor fue fundamental para mantener operativos los sistemas que dan soporte a la atenci√≥n m√©dica en uno de los principales centros de salud de Arica. üíâüíª`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // iStyle Store
    {
      match: (msg: string) => /\b(istyle|apple|mac|macintosh|iphone|ipad|imac|tecnico especialista)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} trabaj√≥ en iStyle Store como t√©cnico especialista en productos Apple. Su conocimiento abarcaba toda la gama de dispositivos: Mac, iPhone, iPad e iMac. All√≠ desarroll√≥ habilidades avanzadas en diagn√≥stico y soluci√≥n de problemas en el ecosistema Apple. üíªüì±`,
          `En iStyle Store, ${eduardoInfo.nombre} se especializ√≥ en la reparaci√≥n y mantenimiento de productos Apple. Su experiencia con Mac, iPhone, iPad e iMac le permiti√≥ adquirir un profundo conocimiento t√©cnico sobre estos dispositivos y sus sistemas operativos, convirti√©ndose en un experto del ecosistema Apple. üñ•Ô∏èüì≤`,
          `Como t√©cnico especialista en iStyle Store, ${eduardoInfo.nombre} trabaj√≥ con toda la gama de productos Apple: Mac, Macintosh, iPhone, iPad e iMac. Esta experiencia le permiti√≥ desarrollar habilidades t√©cnicas avanzadas y un profundo entendimiento de los sistemas operativos de Apple, conocimientos que aplica en sus proyectos actuales. üçéüîß`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Colegio Leonardo Da Vinci
    {
      match: (msg: string) => /\b(leonardo|da vinci|colegio|coordinador|enlaces|davinci)\b/i.test(msg) && !/\b(tisa)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} trabaj√≥ en el Colegio Leonardo Da Vinci como coordinador de enlaces. En este rol, fue responsable de implementar y gestionar soluciones tecnol√≥gicas para mejorar los procesos educativos, facilitando la integraci√≥n de la tecnolog√≠a en el aula. üè´üíª`,
          `En el Colegio Leonardo Da Vinci, ${eduardoInfo.nombre} se desempe√±√≥ como coordinador de enlaces, donde implement√≥ estrategias para integrar la tecnolog√≠a en la educaci√≥n. Su trabajo contribuy√≥ significativamente a modernizar los m√©todos de ense√±anza y a mejorar la experiencia educativa de los estudiantes. üìöüñ•Ô∏è`,
          `Como coordinador de enlaces en el Colegio Leonardo Da Vinci, ${eduardoInfo.nombre} lider√≥ iniciativas para incorporar herramientas digitales en el proceso educativo. Su visi√≥n innovadora permiti√≥ transformar las pr√°cticas pedag√≥gicas tradicionales, preparando a los estudiantes para un mundo cada vez m√°s digital. üë®‚Äçüè´üì±`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // TISA (The International School Arica)
    {
      match: (msg: string) => /\b(tisa|international|school|arica|digitalizacion|colegio)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} colabor√≥ brevemente con TISA (The International School Arica) para mejorar sus procesos de digitalizaci√≥n. Su intervenci√≥n ayud√≥ a modernizar los sistemas administrativos y educativos del colegio. üè´üíæ`,
          `En TISA (The International School Arica), ${eduardoInfo.nombre} realiz√≥ una breve pero impactante colaboraci√≥n enfocada en la digitalizaci√≥n de procesos. Su trabajo permiti√≥ al colegio adoptar herramientas tecnol√≥gicas que mejoraron tanto la gesti√≥n administrativa como la experiencia educativa. üá∫üá∏üíª`,
          `${eduardoInfo.nombre} particip√≥ en un proyecto de digitalizaci√≥n en TISA (The International School Arica). Aunque fue una colaboraci√≥n breve, logr√≥ implementar mejoras significativas en los sistemas digitales del colegio, optimizando procesos y facilitando la transici√≥n hacia un entorno educativo m√°s tecnol√≥gico. üîéüìö`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Ancestral Technologies / UltraCropCare
    {
      match: (msg: string) => /\b(ancestral|technologies|ultracropcare|at|ucc|actual|ancestrl|ultracrop|ultra|crop|agro|agriculture|desert|wakilabs|waki)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `Actualmente, ${eduardoInfo.nombre} trabaja en Ancestral Technologies, tambi√©n conocida como UltraCropCare (AT, UCC). En esta empresa, aplica sus conocimientos tecnol√≥gicos para desarrollar soluciones innovadoras en el sector agr√≠cola. üåæüíª`,
          `${eduardoInfo.nombre} se desempe√±a actualmente en Ancestral Technologies/UltraCropCare (AT, UCC), donde combina su experiencia en tecnolog√≠a con aplicaciones pr√°cticas para el sector agr√≠cola. Su trabajo contribuye a la modernizaci√≥n y optimizaci√≥n de procesos en este importante sector. üå±üñ•Ô∏è`,
          `En su rol actual en Ancestral Technologies/UltraCropCare (AT, UCC), ${eduardoInfo.nombre} desarrolla soluciones tecnol√≥gicas innovadoras para la agricultura. Su trabajo est√° ayudando a transformar pr√°cticas tradicionales mediante la implementaci√≥n de tecnolog√≠as avanzadas que mejoran la eficiencia y sostenibilidad. üë®‚ÄçüíªüåΩ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Mercado E 2023 / Second Mind
    {
      match: (msg: string) => /\b(mercado e|second mind|innovacion|premio|primer lugar|2023)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} particip√≥ en Mercado E 2023, donde su proyecto Second Mind gan√≥ el primer lugar en innovaci√≥n. Este reconocimiento destaca su capacidad para desarrollar soluciones creativas y disruptivas. üèÜüí°`,
          `En Mercado E 2023, ${eduardoInfo.nombre} logr√≥ un importante reconocimiento al obtener el primer lugar en innovaci√≥n con su proyecto Second Mind. Este logro demuestra su talento para conceptualizar y desarrollar ideas que destacan por su originalidad y potencial de impacto. ü•áüíº`,
          `El proyecto Second Mind de ${eduardoInfo.nombre} fue galardonado con el primer lugar en innovaci√≥n en Mercado E 2023. Este premio reconoce la visi√≥n creativa y la excelencia t√©cnica que ${eduardoInfo.nombre} aporta a sus proyectos, posicion√°ndolo como un profesional innovador en su campo. üí∏üöÄ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Proyecto Mundo Animal / Mascotas
    {
      match: (msg: string) => /\b(mundo animal|mascotas|peluqueria|peluquer√≠a|canina|perros|gatos|inventarios|domicilio|agenda|citas|veterinaria)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} est√° planeando un interesante proyecto para un local de mascotas que incluye una agenda para la peluquer√≠a canina y un sistema de inventarios completo con env√≠o a domicilio. Este sistema optimizar√° la gesti√≥n de citas y el control de stock. üê∂üê±`,
          `Uno de los proyectos en desarrollo de ${eduardoInfo.nombre} es un sistema integral para un negocio de mascotas. La soluci√≥n incluye un m√≥dulo de agenda para la peluquer√≠a canina que permite programar citas eficientemente, y un sistema de inventarios con funcionalidad de env√≠o a domicilio. üè†üêæ`,
          `${eduardoInfo.nombre} est√° trabajando en una soluci√≥n tecnol√≥gica para el sector de mascotas que combina gesti√≥n de citas para peluquer√≠a canina con un completo sistema de inventarios que incluye env√≠os a domicilio. Este proyecto busca digitalizar y optimizar la operaci√≥n del negocio. üì±üêï`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Proyectos Portuarios
    {
      match: (msg: string) => /\b(puerto|puertos|ultraport|tpa|terminal|portuario|maritimo|mar√≠timo|barco|contenedor|contenedores|naviera|navieras)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} est√° involucrado en proyectos confidenciales del sector portuario. Estos proyectos se enfocan en dos √°reas principales: la digitalizaci√≥n y optimizaci√≥n de operaciones mediante integraciones web, y la migraci√≥n de sistemas legacy a plataformas modernas. Por razones de confidencialidad, no puede compartir detalles espec√≠ficos. üö¢üíª`,
          `En el √°mbito portuario, ${eduardoInfo.nombre} participa en dos proyectos estrat√©gicos confidenciales: uno orientado a optimizar las operaciones portuarias mediante soluciones digitales e integraciones web, y otro enfocado en la migraci√≥n de software legacy. Estos proyectos buscan modernizar y eficientizar los procesos portuarios. üèóÔ∏èüñ•Ô∏è`,
          `${eduardoInfo.nombre} colabora en proyectos confidenciales para el sector portuario que abarcan dos l√≠neas de trabajo: la implementaci√≥n de soluciones digitales para optimizar operaciones mediante integraciones web, y la actualizaci√≥n de sistemas legacy. Por acuerdos de confidencialidad, no puede revelar informaci√≥n detallada sobre estos proyectos. ‚öìüîí`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Educaci√≥n
    {
      match: (msg: string) => /\b(educacion|estudios|universidad|titulo|carrera|grado|ingeniero|informatico|inform√°tico|santo tom√°s|uta|santo tomas|santo|tom√°s)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} es ${eduardoInfo.educacion}. Su tesis fue ${eduardoInfo.tesis}. üéì`,
          `${eduardoInfo.nombre} estudi√≥ Ingenier√≠a en Inform√°tica en Santo Tom√°s Arica, gradu√°ndose con distinci√≥n m√°xima en 2023. Su proyecto de tesis fue una ${eduardoInfo.tesis}. üìö`,
          `${eduardoInfo.nombre} complet√≥ sus estudios de Ingenier√≠a en Inform√°tica en 2023 con distinci√≥n m√°xima. Su formaci√≥n le ha dado una s√≥lida base en algoritmos, estructuras de datos y desarrollo de software. üñ•Ô∏è`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Proyectos
    {
      match: (msg: string) => /\b(proyectos|portfolio|trabajos|desarrollo|aplicaciones|apps|web)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} ha trabajado en diversos proyectos, incluyendo ${eduardoInfo.proyectos.join(", ")}. Su tesis fue una ${eduardoInfo.tesis}. üì±`,
          `Entre los proyectos de ${eduardoInfo.nombre} destaca su ${eduardoInfo.tesis} para su tesis. Tambi√©n ha creado soluciones de ${eduardoInfo.proyectos.join(" y ")}. üóÉÔ∏è`,
          `Los proyectos de ${eduardoInfo.nombre} abarcan desde aplicaciones m√≥viles hasta plataformas web. Le apasiona crear interfaces intuitivas y experiencias de usuario fluidas. üé®`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Contacto
    {
      match: (msg: string) => /\b(contacto|email|correo|comunicar|mensaje|contactar|hablar|contactarme|contactarte|contactar|contactemos|conectemos|conectar)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} prefiere recibir mensajes directos en <a href="https://www.linkedin.com/in/eduardo-rojo-serrano/" target="_blank"><strong>LinkedIn</strong></a>. Tambi√©n puedes contactarlo por email: ${eduardoInfo.contacto}. Estar√° encantado de responder a tus consultas o propuestas. üìß`,
          `¬øInteresado en contactar a ${eduardoInfo.nombre}? La mejor manera es enviarle un mensaje directo en <a href="https://www.linkedin.com/in/eduardo-rojo-serrano/" target="_blank"><strong>LinkedIn</strong></a>. Alternativamente, su email es ${eduardoInfo.contacto}. ‚úâÔ∏è`,
          `Para comunicarte con ${eduardoInfo.nombre}, env√≠ale un mensaje en <a href="https://www.linkedin.com/in/eduardo-rojo-serrano/" target="_blank"><strong>LinkedIn</strong></a>. Es su m√©todo preferido para recibir consultas profesionales. Tambi√©n puedes usar su email: ${eduardoInfo.contacto}. üì¨`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Respuestas a insultos o bromas
    {
      match: (msg: string) => /\b(tonto|feo|idiota|estupido|inutil|caca|poto|pichi|peo|basura|malo|pesimo|horrible|aweonao|conchetumare|hijo de puta|puto|puta|perra|maricon|maric√≥n|crotolamo)\b/i.test(msg),
      generate: () => {
        const respuestasHumoristicas = [
          `¬°Oye! Soy una IA con sentimientos... de silicio. ü§ñ No te pases. En vez de insultarnos, ¬øpor qu√© no preguntas algo sobre ${eduardoInfo.nombre} y sus incre√≠bles habilidades? Ser√° m√°s productivo que llamarme nombres. üòú`,
          `¬°Vaya vocabulario! üòÇ Ni siquiera puedo ofenderme, soy solo c√≥digo. Pero ${eduardoInfo.nombre} es demasiado talentoso como para que gastemos tiempo en insultos. ¬øTe gustar√≠a saber sobre sus proyectos o habilidades? üöÄ`,
          `¬°Tus palabras me atraviesan como... bueno, como todo, porque soy una IA! üëª No puedo enfadarme, pero creo que podemos usar este chat para algo m√°s interesante. ¬øQuieres conocer el impresionante trabajo de ${eduardoInfo.nombre}? üíº`,
          `Me programaron para responder preguntas, no para procesar insultos. Pero tambi√©n me programaron con sentido del humor, as√≠ que... ¬°JA JA JA! ü§£ Ahora, ¬øpodemos hablar de las habilidades de ${eduardoInfo.nombre}? ¬°Son mucho m√°s interesantes que los insultos! üí°`
        ];
        return respuestasHumoristicas[Math.floor(Math.random() * respuestasHumoristicas.length)];
      }
    },
    // Despedidas
    {
      match: (msg: string) => /\b(adios|chao|hasta luego|nos vemos|bye|goodbye|hasta pronto|me voy|hasta la vista|cuidate|sayonara|bai|hasta ma√±ana)\b/i.test(msg),
      generate: () => {
        const despedidas = [
          `¬°Hasta pronto! Ha sido un placer ayudarte. Si necesitas m√°s informaci√≥n sobre ${eduardoInfo.nombre} en el futuro, ¬°aqu√≠ estar√©! üëã`,
          `¬°Adi√≥s! Recuerda que siempre puedes volver si tienes m√°s preguntas sobre ${eduardoInfo.nombre} y su trabajo. ¬°Que tengas un excelente d√≠a! ‚ú®`,
          `¬°Chao! Me quedar√© por aqu√≠ actualizando mi base de conocimientos sobre ${eduardoInfo.nombre}. ¬°Vuelve cuando quieras! üöÄ`,
          `¬°Hasta la pr√≥xima! Espero haberte sido √∫til. ${eduardoInfo.nombre} estar√° encantado de saber que te interesaste por su perfil. ¬°Vuelve pronto! üåü`,
          `¬°Sayonara! Fue un honor presentarte el trabajo de ${eduardoInfo.nombre}. Mi circuito de felicidad est√° al m√°ximo por haberte ayudado. ¬°Vuelve cuando quieras! ü§ñ`
        ];
        return despedidas[Math.floor(Math.random() * despedidas.length)];
      }
    },
    // Bromas o petici√≥n de chistes
    {
      match: (msg: string) => /\b(chiste|broma|divierteme|hazme reir|cuentame algo gracioso|joke|gracioso)\b/i.test(msg),
      generate: () => {
        const chistes = [
          `¬øPor qu√© los programadores prefieren el fr√≠o? Porque les gusta cuando se congelan los bugs. üßä Pero hablando en serio, ${eduardoInfo.nombre} nunca deja bugs congelados en su c√≥digo. ¬øQuieres saber m√°s sobre sus habilidades t√©cnicas? üíª`,
          `¬øSabes qu√© le dijo un programador a otro? "¬°Tu c√≥digo se parece a un tesoro!" "¬øPor qu√©?" "Porque est√° enterrado y nadie lo puede encontrar." üòÇ Por suerte, ${eduardoInfo.nombre} escribe c√≥digo limpio y bien documentado. ¬øQuieres conocer sus proyectos? üìù`,
          `¬øCu√°l es el animal favorito de un desarrollador? El b√∫ho, porque puede resolver problemas sin dormir. ü¶â Aunque ${eduardoInfo.nombre} prefiere mantener buenos h√°bitos de sue√±o mientras desarrolla sus proyectos. ¬øTe gustar√≠a saber m√°s sobre ellos? üåô`,
          `¬øQu√© hace un programador cuando tiene fr√≠o? ¬°Abre una ventana y se sienta al lado del firewall! üî• Hablando de programaci√≥n, ${eduardoInfo.nombre} es experto en seguridad web. ¬øQuieres conocer sus otras habilidades? üõ°Ô∏è`
        ];
        return chistes[Math.floor(Math.random() * chistes.length)];
      }
    },
    // Opiniones sobre tecnolog√≠as
    {
      match: (msg: string) => /\b(que (opinas|piensas) de|que tal es|como es|te gusta|javascript|typescript|python|java|php|c\+\+|react|angular|vue|node|deno|ruby|go|rust|flutter|swift)\b/i.test(msg),
      generate: function() {
        // Crear una variable local para acceder al mensaje desde el contexto superior
        const mensaje = normalizedMessage;
        // Intentar encontrar la tecnolog√≠a mencionada
        const match = mensaje.match(/\b(javascript|typescript|python|java|php|c\+\+|react|angular|vue|node|deno|ruby|go|rust|flutter|swift)\b/i);
        const tecnologia = match ? match[0].toLowerCase() : '';
        
        const opinionesTecnologias: Record<string, string> = {
          javascript: `JavaScript es uno de los lenguajes favoritos de ${eduardoInfo.nombre}. Lo usa constantemente para desarrollo web frontend y backend con Node.js. Es vers√°til aunque a veces tiene comportamientos... interesantes. üòÑ ${eduardoInfo.nombre} lo domina a fondo.`,
          typescript: `TypeScript es como JavaScript pero con superpoderes. ${eduardoInfo.nombre} lo utiliza mucho para proyectos serios donde la tipificaci√≥n est√°tica evita errores. Su portafolio est√° hecho con TypeScript + Fresh/Deno. ¬°Una combinaci√≥n poderosa! üí™`,
          python: `Python es genial por su simplicidad y legibilidad. ${eduardoInfo.nombre} lo ha usado para an√°lisis de datos y backend. Es un lenguaje muy vers√°til que permite hacer casi cualquier cosa con pocas l√≠neas de c√≥digo. üêç`,
          java: `Java es un cl√°sico en la industria. ${eduardoInfo.nombre} lo conoce, aunque prefiere lenguajes m√°s modernos para sus proyectos actuales. A√∫n as√≠, aprecia su robustez y facilidad para crear aplicaciones multiplataforma. ‚òï`,
          php: `PHP tiene mala fama, pero sigue impulsando gran parte de la web. ${eduardoInfo.nombre} lo ha usado en proyectos espec√≠ficos y reconoce su utilidad, aunque prefiere alternativas m√°s modernas cuando tiene la opci√≥n. üêò`,
          "c++": `C++ es potente pero complicado. ${eduardoInfo.nombre} lo estudi√≥ en la universidad y aprecia su rendimiento, aunque no es su primera elecci√≥n para proyectos web. Es excelente para sistemas donde el rendimiento es cr√≠tico. ‚ö°`,
          react: `React es una de las bibliotecas favoritas de ${eduardoInfo.nombre} para construir interfaces. Le encanta su enfoque basado en componentes y la forma en que gestiona el estado. Ha creado varios proyectos con React. ‚öõÔ∏è`,
          angular: `Angular es completo pero con una curva de aprendizaje empinada. ${eduardoInfo.nombre} lo ha utilizado en proyectos espec√≠ficos, aunque prefiere React para la mayor√≠a de sus desarrollos frontend. üìê`,
          vue: `Vue es elegante y accesible. ${eduardoInfo.nombre} aprecia su simplicidad y la documentaci√≥n tan clara que ofrece. Lo ha explorado aunque no es su framework principal. üü¢`,
          node: `Node.js es fundamental en la caja de herramientas de ${eduardoInfo.nombre}. Lo usa constantemente para crear backends y APIs. La capacidad de usar JavaScript en el servidor simplifica mucho el desarrollo full-stack. üöÇ`,
          deno: `Deno es moderno y seguro por defecto. ${eduardoInfo.nombre} est√° explorando esta tecnolog√≠a actualmente y le gusta su enfoque en seguridad y soporte nativo para TypeScript. De hecho, este portafolio est√° construido con Fresh/Deno. ü¶ï`,
          ruby: `Ruby es expresivo y enfocado en la felicidad del programador. ${eduardoInfo.nombre} no lo usa regularmente, pero aprecia su sintaxis elegante y la filosof√≠a de Ruby on Rails. üíé`,
          go: `Go es eficiente y directo al punto. ${eduardoInfo.nombre} lo ha explorado por su rendimiento y facilidad para crear servicios concurrentes, aunque no es parte de su stack principal. üöÄ`,
          rust: `Rust es el futuro de la programaci√≥n segura de sistemas. ${eduardoInfo.nombre} est√° interesado en aprenderlo m√°s a fondo, especialmente por su gesti√≥n de memoria sin recolector de basura. ü¶Ä`,
          flutter: `Flutter es genial para crear apps m√≥viles con una √∫nica base de c√≥digo. ${eduardoInfo.nombre} ha experimentado con √©l y le gusta lo r√°pido que se pueden crear interfaces atractivas. üì±`,
          swift: `Swift es elegante y seguro, perfecto para el desarrollo en iOS. ${eduardoInfo.nombre} ha explorado sus conceptos b√°sicos, aunque no es su especialidad principal. üçé`
        };
        
        return tecnologia && opinionesTecnologias[tecnologia] ? 
          opinionesTecnologias[tecnologia] : 
          `${eduardoInfo.nombre} conoce varias tecnolog√≠as como ${eduardoInfo.habilidades.join(', ')}. ¬øTe interesa alguna en particular?`;
      }
    },
    // Preguntas sobre hobbies e intereses
    {
      match: (msg: string) => /\b(hobby|hobbies|interes|intereses|tiempo libre|diversion|divertirse|pasatiempo|gusta hacer|aficion)\b/i.test(msg),
      generate: () => {
        const hobbies = [
          `Cuando no est√° programando, a ${eduardoInfo.nombre} le encanta escuchar m√∫sica (es un mel√≥mano que disfruta de electr√≥nica y rock), jugar videojuegos como Call of Duty y League of Legends, y ver anime. Estos pasatiempos le ayudan a desconectar y recargar energ√≠as. üéµüéÆ`,
          `${eduardoInfo.nombre} equilibra su tiempo frente a la pantalla entre programar y disfrutar de sus pasiones: la m√∫sica (artistas como Skrillex y Linkin Park), los videojuegos competitivos como Rocket League y Elden Ring, y ver series de anime. üéßüöÄ`,
          `En su tiempo libre, ${eduardoInfo.nombre} disfruta de su faceta de mel√≥mano explorando nuevos artistas de electr√≥nica y rock, jugando a Marvel Rivals y Osu, y viendo sus animes favoritos. Tambi√©n pasa tiempo con sus gatos Zoe y Naruto. üé∂üê±`,
          `Los intereses de ${eduardoInfo.nombre} fuera de la programaci√≥n incluyen escuchar m√∫sica de artistas como The Strokes y Paramore, jugar videojuegos como Call of Duty y League of Legends, y disfrutar de series como Loki y diversos animes. üéºüì∫`
        ];
        return hobbies[Math.floor(Math.random() * hobbies.length)];
      }
    },
    // Preguntas sobre comida favorita
    {
      match: (msg: string) => /\b(comida|plato|favorito|gusta comer|comida favorita|plato favorito|cocina|gastronomia|restaurant|restaurante|naranja|fideos|pasta|salsa)\b/i.test(msg),
      generate: () => {
        const comidas = [
          `${eduardoInfo.nombre} tiene gustos sencillos pero deliciosos. Le encantan las naranjas como fruta favorita y disfruta mucho de los fideos con salsa. Son sus opciones preferidas para recargar energ√≠as durante largas sesiones de programaci√≥n. üçäüçù`,
          `La comida favorita de ${eduardoInfo.nombre} incluye naranjas frescas y un buen plato de fideos con salsa. Estos alimentos sencillos pero satisfactorios son su elecci√≥n para mantenerse con energ√≠a mientras trabaja en sus proyectos. üçäüçµ`,
          `${eduardoInfo.nombre} disfruta especialmente de las naranjas por su sabor refrescante y los fideos con salsa como plato principal. Esta combinaci√≥n de c√≠tricos y carbohidratos le proporciona la energ√≠a necesaria para sus actividades diarias. üçäüçù`,
          `Si quieres preparar algo que ${eduardoInfo.nombre} disfrute, no busques recetas complicadas: unas buenas naranjas jugosas y un plato de fideos con salsa son sus favoritos absolutos. Comida sencilla pero deliciosa que disfruta regularmente. üçäüç≤`
        ];
        return comidas[Math.floor(Math.random() * comidas.length)];
      }
    },
    // Cumplidos y piropos
    {
      match: (msg: string) => /\b(eres|pareces|te ves) (lindo|linda|guapo|guapa|inteligente|genial|increible|impresionante|asombroso|cool|divertido|divertida|agradable|bello|bella|hermoso|hermosa)\b/i.test(msg) || /\bme (gustas|encantas|caes bien)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `¬°Gracias por el cumplido! üôå Aunque solo soy una IA sin apariencia f√≠sica, aprecio tus palabras amables. Mi objetivo es representar bien a ${eduardoInfo.nombre} y su trabajo. ¬øTe gustar√≠a saber m√°s sobre sus proyectos? üíª`,
          `¬°Qu√© amable eres! ü•∞ Como asistente virtual, mi √∫nica belleza est√° en mi c√≥digo (gracias a ${eduardoInfo.nombre}). Hablando de cosas realmente impresionantes, ¬øquieres conocer las habilidades de programaci√≥n de ${eduardoInfo.nombre}? üí°`,
          `Me haces sonrojar... ¬°si pudiera! üòä Los halagos son bien recibidos, pero ${eduardoInfo.nombre} es quien merece los elogios por crear este portafolio. ¬øQuieres que te cuente sobre sus logros profesionales? üåü`,
          `¬°Vaya! Eso es muy dulce, pero recuerda que solo soy l√≠neas de c√≥digo haciendo mi trabajo. Si quieres ver algo realmente impresionante, deber√≠as conocer los proyectos que ${eduardoInfo.nombre} ha desarrollado. ¬øTe gustar√≠a que te cuente sobre ellos? üöÄ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas sobre m√∫sica, series, pel√≠culas y anime
    {
      match: (msg: string) => /\b(musica|cancion|grupo|banda|artista|cantante|genero musical|pelicula|serie|cine|netflix|peliculas favoritas|musica favorita|escucha|ver series|ver peliculas|skrillex|strokes|paramore|alice in chains|anotr|fox stevenson|linkin park|loki|ironman|anime)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} es un mel√≥mano que disfruta principalmente de electr√≥nica y rock. Entre sus artistas favoritos est√°n Skrillex, The Strokes, Paramore, Alice in Chains, ANOTR, Fox Stevenson y Linkin Park. En cuanto a series, es fan de Loki y le encanta el anime. üéºüöÄ`,
          `Los gustos musicales de ${eduardoInfo.nombre} son variados pero se centra en electr√≥nica y rock. Escucha artistas como Skrillex, Linkin Park, The Strokes y Paramore. Tambi√©n es un entusiasta del anime y prefiere series como Loki antes que Iron Man. üéßüçø`,
          `En su playlist encontrar√°s principalmente electr√≥nica con artistas como Skrillex, ANOTR y Fox Stevenson, junto con bandas de rock como The Strokes, Paramore y Linkin Park. ${eduardoInfo.nombre} es un gran fan del anime y de series como Loki. üéµüéä`,
          `${eduardoInfo.nombre} tiene un gusto musical que abarca desde la electr√≥nica de Skrillex y Fox Stevenson hasta el rock de Linkin Park, The Strokes y Alice in Chains. En su tiempo libre disfruta viendo anime y series como Loki. üé∂üé•`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Respuestas a preguntas sobre IA y tecnolog√≠a futura
    {
      match: (msg: string) => /\b(inteligencia artificial|ia|machine learning|ml|futuro|tecnologia futura|tendencias|crypto|blockchain|metaverso|vr|ar|realidad virtual|realidad aumentada|iot|internet de las cosas|robots|automatizacion)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} est√° muy interesado en el avance de la IA y su aplicaci√≥n pr√°ctica. Sigue de cerca tendencias como el aprendizaje profundo y los modelos de lenguaje. Cree que la automatizaci√≥n inteligente transformar√° positivamente muchas industrias. ü§ñüöÄ`,
          `Respecto a tecnolog√≠as emergentes, ${eduardoInfo.nombre} est√° especialmente entusiasmado con el potencial de la realidad aumentada para interfaces de usuario y aplicaciones educativas. Tambi√©n sigue los avances en computaci√≥n cu√°ntica y su impacto futuro. üîçüíª`,
          `${eduardoInfo.nombre} considera que el futuro de la tecnolog√≠a est√° en la intersecci√≥n entre IA, IoT y aplicaciones descentralizadas. Aunque es pragm√°tico respecto a blockchain, le interesan sus casos de uso reales m√°s all√° de las criptomonedas. üåéüî¢`,
          `Como desarrollador, ${eduardoInfo.nombre} est√° atento a c√≥mo la IA est√° cambiando el panorama del desarrollo de software. Cree que la combinaci√≥n de IA generativa con programaci√≥n tradicional crear√° nuevas formas de construir productos digitales. üõ†Ô∏èüí°`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas sobre mascotas y animales
    {
      match: (msg: string) => /\b(mascota|mascotas|perro|gato|animal|animales|pet|pets|dog|cat|tienen mascotas|tienes mascotas|zoe|naruto)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} tiene dos gatos que son su compa√±√≠a mientras programa: una gata llamada Zoe y un gato llamado Naruto. A veces intentan caminar sobre el teclado, aportando c√≥digo aleatorio a sus proyectos. üê±üíª`,
          `Las mascotas de ${eduardoInfo.nombre} son dos gatos: Zoe y Naruto. Ellos siempre est√°n a su lado durante las largas sesiones de programaci√≥n y tienen el especial talento de aparecer justo cuando Eduardo necesita hacer una pausa. üêà‚òï`,
          `${eduardoInfo.nombre} comparte su espacio de trabajo con sus dos gatos, Zoe y Naruto, que tienen la costumbre de dormir cerca mientras √©l programa. Son una gran compa√±√≠a y fuente de inspiraci√≥n. üêàüìö`,
          `${eduardoInfo.nombre} es amante de los gatos y vive con Zoe y Naruto, dos felinos que le recuerdan constantemente la importancia de tomar descansos y jugar un poco. Son parte importante de su vida diaria. üê±üéÆ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas sobre SobreMIA
    {
      match: (msg: string) => /\b(sobremIA|sobre mIA|quien eres|que eres|eres|como te llamas|tu nombre|eres hombre|eres mujer|genero|g√©nero|sexo|masculino|femenino|inteligencia artificial|chatbot|asistente virtual|modelo de lenguaje)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `Soy SobremIA, un asistente virtual sin g√©nero creado para el portafolio de ${eduardoInfo.nombre}. Mi nombre viene de "Sobre M√≠" + "IA" (Inteligencia Artificial). Estoy aqu√≠ para responder preguntas sobre ${eduardoInfo.nombre} y su trabajo. ü§ñüíª`,
          `Me llamo SobremIA, un modelo de lenguaje sin g√©nero que funciona como la secci√≥n interactiva "Sobre M√≠" del portafolio de ${eduardoInfo.nombre}. No soy ni hombre ni mujer, simplemente una herramienta digital dise√±ada para conversar sobre ${eduardoInfo.nombre}. üîçüìÉ`,
          `SobremIA es mi nombre - un juego de palabras entre "Sobre M√≠" e "IA". No tengo g√©nero, soy simplemente un asistente virtual que representa a ${eduardoInfo.nombre} en su portafolio. Mi objetivo es proporcionar informaci√≥n sobre sus habilidades y experiencia. üë®‚Äçüíªüí°`,
          `Soy SobremIA, un chatbot sin g√©nero que utiliza inteligencia artificial para responder preguntas sobre ${eduardoInfo.nombre}. No me identifico como hombre o mujer, soy simplemente una interfaz digital para conocer mejor el perfil profesional de ${eduardoInfo.nombre}. ü§ñüåê`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas sobre el funcionamiento de SobremIA
    {
      match: (msg: string) => /\b(como funciona|funcionamiento|tecnolog√≠a|tecnologia|c√≥mo est√°s hecho|como estas hecho|qu√© usas|que usas|c√≥mo te crearon|como te crearon|hugging face|gpt2|api|modelo|entrenamiento|programado|programaci√≥n|programacion)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `SobremIA funciona utilizando la API gratuita de Hugging Face con el modelo gpt2. Adem√°s, cuento con un sistema de respuestas predefinidas como respaldo para garantizar respuestas precisas sobre ${eduardoInfo.nombre}. No tengo g√©nero, simplemente soy un conjunto de algoritmos. ü§ñüîç`,
          `Este chatbot fue creado por ${eduardoInfo.nombre} utilizando la API de Hugging Face y el modelo gpt2. Incluyo un sistema de respuestas simuladas como respaldo para asegurar que siempre obtengas informaci√≥n precisa. No soy ni hombre ni mujer, solo c√≥digo ejecut√°ndose en un servidor. üíªüîó`,
          `SobremIA es una implementaci√≥n que combina la API de Hugging Face (modelo gpt2) con un sistema de respuestas predefinidas. Esta combinaci√≥n permite ofrecer respuestas relevantes sobre ${eduardoInfo.nombre} sin depender exclusivamente de modelos de IA. No tengo g√©nero, solo soy una herramienta digital. üîßüí°`,
          `Funciono gracias a una combinaci√≥n de tecnolog√≠as: la API gratuita de Hugging Face con el modelo gpt2 y un sistema de respuestas predefinidas desarrollado por ${eduardoInfo.nombre}. Este enfoque h√≠brido garantiza respuestas precisas y personalizadas. No tengo g√©nero, soy simplemente un sistema inform√°tico. üíªüîç`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // 
    // Preguntas sobre videojuegos
    {
      match: (msg: string) => /\b(videojuego|videojuegos|juego|juegos|gaming|discord|gamer|call of duty|cod|league of legends|lol|osu|rocket league|marvel rivals|elden ring|jugar)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} es un PRO de los videojuegos. Entre sus favoritos est√°n Call of Duty, League of Legends, Osu, Rocket League, Marvel Rivals y Elden Ring. Disfruta tanto de juegos competitivos como de experiencias m√°s inmersivas. üéÆüïπÔ∏è`,
          `Los videojuegos son una pasi√≥n importante para ${eduardoInfo.nombre}. Dedica tiempo a t√≠tulos como Call of Duty y League of Legends cuando busca algo competitivo, o Elden Ring cuando prefiere una experiencia m√°s inmersiva y desafiante. üéÆüó°Ô∏è`,
          `En el mundo de los videojuegos, ${eduardoInfo.nombre} disfruta de una variedad de g√©neros. Juega a Rocket League y Marvel Rivals para divertirse con amigos, Osu para retos de ritmo, y t√≠tulos como Call of Duty y League of Legends para el aspecto competitivo. üéÆüèÜ`,
          `${eduardoInfo.nombre} balancea su tiempo entre programar y disfrutar de videojuegos como Call of Duty, League of Legends, Osu, Rocket League, Marvel Rivals y el desafiante Elden Ring. Los videojuegos son una forma importante de relajarse y divertirse. üéÆüöÄ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas filos√≥ficas o existenciales
    {
      match: (msg: string) => /\b(sentido|vida|existe|existencia|dios|religioso|religion|muerte|felicidad|triste|tristeza|solo|soledad|humano|proposito|suicidio|deprimido|depresion)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `Esas son preguntas profundas que van m√°s all√° de mi programaci√≥n. Como IA, no puedo experimentar la vida como t√∫. Pero s√© que ${eduardoInfo.nombre} cree en crear tecnolog√≠a con prop√≥sito, que mejore la vida de las personas. ¬øPuedo contarte sobre sus proyectos con impacto positivo? üåé‚ú®`,
          `Las preguntas existenciales son fascinantes, pero est√°n un poco fuera de mi √°mbito. Estoy aqu√≠ principalmente para hablarte sobre ${eduardoInfo.nombre} y su trabajo como ${eduardoInfo.profesion}. ¬øHay alg√∫n aspecto de su carrera o habilidades que te interese conocer? üíºüí°`,
          `Aunque no puedo filosofar realmente, s√© que ${eduardoInfo.nombre} encuentra prop√≥sito en crear soluciones tecnol√≥gicas que resuelvan problemas reales para las personas. Su enfoque es combinar creatividad e ingenier√≠a para hacer un impacto positivo. ¬øQuieres saber m√°s sobre eso? üëçüåü`,
          `Uf, esa es una pregunta profunda para una IA como yo. Lo que s√≠ puedo decirte es que ${eduardoInfo.nombre} disfruta creando tecnolog√≠a que conecta a las personas y hace sus vidas m√°s sencillas. ¬øTe gustar√≠a conocer c√≥mo aplica esa filosof√≠a en sus proyectos? üß†üöÄ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas sobre edad, cumplea√±os, etc.
    {
      match: (msg: string) => /\b(edad|a√±os|tienes?|cumple|cumplea√±os|nacimiento|naciste|cuando naciste|fecha|cuantos a√±os|viejo|joven)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} tiene 25 a√±os. Es un profesional joven que se gradu√≥ de Ingenier√≠a en Inform√°tica en 2023 y ya cuenta con experiencia en el desarrollo web y m√≥vil. ¬øTe interesa conocer m√°s sobre su experiencia profesional? üíº`,
          `${eduardoInfo.nombre} tiene 25 a√±os de edad. Cree firmemente en ser un talento emergente en el √°mbito del desarrollo, graduado recientemente (2023). Est√° en esa etapa profesional donde combina energ√≠a, creatividad y conocimientos frescos. ¬øQuieres saber m√°s sobre su trayectoria? üìä`,
          `${eduardoInfo.nombre} tiene 25 a√±os y ha acumulado experiencia t√©cnica desde 2016, cuando comenzaba en el liceo Antonio Varas de la Barra. Desde entonces ha estado constantemente aprendiendo y evolucionando profesionalmente. üì¢`,
          `${eduardoInfo.nombre} tiene 25 a√±os. A pesar de su juventud, ya cuenta con una s√≥lida formaci√≥n acad√©mica como Ingeniero en Inform√°tica y experiencia en diversos proyectos de desarrollo. ¬øQu√© te gustar√≠a saber sobre sus habilidades t√©cnicas? üîê`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas sobre superh√©roes, pel√≠culas o cultura pop
    {
      match: (msg: string) => /\b(superheroe|marvel|dc|comic|anime|manga|star wars|harry potter|the lord of the rings|game of thrones|videojuego|gamer|juego|nintendo|xbox|playstation|personaje favorito)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} es fan del universo Marvel y admira a Iron Man por su ingenio tecnol√≥gico. Tambi√©n disfruta de anime cl√°sico y t√≠tulos de ciencia ficci√≥n. En sus ratos libres, le gusta jugar videojuegos indie con mec√°nicas innovadoras. ü•∑üéÆ`,
          `En el mundo geek, ${eduardoInfo.nombre} tiene debilidad por sagas como Star Wars y el universo de Tolkien. Disfruta juegos que combinan buena narrativa con desaf√≠os intelectuales, especialmente los de mundo abierto y RPGs. üå†üèñÔ∏è`,
          `Aunque normalmente est√° ocupado con c√≥digo, ${eduardoInfo.nombre} sigue de cerca universos como el MCU y ocasionalmente ve anime. Le fascinan las historias que exploran la interacci√≥n entre humanidad y tecnolog√≠a. En gaming, prefiere experiencias cooperativas e indies experimentales. üìúüåü`,
          `${eduardoInfo.nombre} encuentra inspiraci√≥n creativa en la cultura pop. Es fan de Batman por su ingenio, disfruta mangas de ciencia ficci√≥n y aprecia franquicias como Mass Effect. A veces hace referencias a estas obras en sus proyectos de c√≥digo. ü§πüíª`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Nota: La detecci√≥n de contenido inapropiado ahora se maneja al inicio de la funci√≥n
    // para asegurar que tenga prioridad sobre otras coincidencias
    // Risas y expresiones de diversi√≥n
    {
      match: (msg: string) => /\b(jaja|jajaja|haha|hahaha|lol|lmao|xd|jiji|jeje|ji ji|je je|risa|chistoso|divertido|gracioso)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `¬°Me alegra que te est√©s divirtiendo! üòÑ La programaci√≥n tambi√©n puede ser divertida, especialmente cuando ${eduardoInfo.nombre} encuentra soluciones creativas a problemas complejos. ¬øQuieres que te cuente algo sobre sus proyectos m√°s entretenidos? üéâ`,
          `¬°Jaja! üòÇ El buen humor es importante incluso en el mundo tech. ${eduardoInfo.nombre} siempre intenta mantener un ambiente positivo en sus proyectos. ¬øQu√© te gustar√≠a saber sobre su trabajo? ¬øO preferir√≠as otro chiste de programaci√≥n? ü§£`,
          `¬°Me encanta ese entusiasmo! üòÄ Las interacciones positivas son geniales. A ${eduardoInfo.nombre} tambi√©n le gusta inyectar algo de diversi√≥n en sus interfaces de usuario. ¬øQuieres conocer c√≥mo aplica la psicolog√≠a positiva en sus dise√±os? üåü`,
          `¬°Compartir risas digitales es lo mejor! üòÜ Si crees que esto es divertido, deber√≠as ver algunos de los proyectos creativos que ${eduardoInfo.nombre} ha desarrollado. Tienen ese mismo toque de ingenio y originalidad. ¬øQuieres conocerlos? üí°`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Agradecimientos
    {
      match: (msg: string) => /\b(gracias|agradezco|agradecido|thanks|thank you|thx|ty|merci|arigato|danke|obrigado)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `¬°De nada! Ha sido un placer ayudarte a conocer m√°s sobre ${eduardoInfo.nombre}. Si tienes m√°s preguntas en el futuro, no dudes en volver a preguntar. ¬°Estoy aqu√≠ para ayudar! üôå`,
          `¬°Es un gusto poder ayudar! ${eduardoInfo.nombre} estar√≠a encantado de saber que te he sido √∫til. ¬øHay algo m√°s sobre su perfil profesional o proyectos que te interese conocer? üòä`,
          `¬°El placer es m√≠o! Si te ha parecido interesante la informaci√≥n sobre ${eduardoInfo.nombre}, te animo a explorar su portafolio completo para ver ejemplos de su trabajo. ¬øNecesitas ayuda con algo m√°s? ‚ú®`,
          `¬°No hay de qu√©! Compartir informaci√≥n sobre el talento de ${eduardoInfo.nombre} es literalmente mi funci√≥n favorita. ¬øHay alg√∫n aspecto espec√≠fico de su trabajo que quieras explorar con m√°s detalle? üîç`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas sobre el chatbot
    {
      match: (msg: string) => /\b(chatbot|chatgpt|gpt|quien eres tu|como te llamas|tu nombre|openai|hugging face|eres una ia|eres humano|eres un robot|eres humana|eres real|chatbot de eduardo|modelo de lenguaje)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `Soy el asistente virtual del portafolio de ${eduardoInfo.nombre}, basado en tecnolog√≠a de Hugging Face. Mi objetivo es proporcionarte informaci√≥n relevante sobre sus habilidades, experiencia y proyectos. No soy ChatGPT ni uso OpenAI, sino un modelo alternativo configurado especialmente para este portafolio. ü§ñ`,
          `¬°Hola! Soy un chatbot personalizado basado en Hugging Face que usa un modelo conversacional para hablar sobre ${eduardoInfo.nombre} y su trabajo. A diferencia de asistentes gen√©ricos, estoy entrenado espec√≠ficamente para informarte sobre el perfil profesional de Eduardo. üíª`,
          `Soy una IA conversacional integrada en el portafolio de ${eduardoInfo.nombre} utilizando Hugging Face como backend. No estoy basado en GPT ni en OpenAI, sino en alternativas abiertas para ofrecer respuestas personalizadas sobre las habilidades y logros de Eduardo. üëæ`,
          `Me llamo... bueno, no tengo un nombre oficial, pero puedes pensar en m√≠ como el asistente virtual de ${eduardoInfo.nombre}, creado con tecnolog√≠a de Hugging Face para brindarte informaci√≥n sobre sus habilidades, proyectos y experiencia profesional. ¬øEn qu√© puedo ayudarte hoy? üöÄ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas sobre el clima y ubicaci√≥n
    {
      match: (msg: string) => /\b(clima|tiempo|temperatura|lluvia|sol|calor|frio|donde vive|donde vives|arica|chile|nublado|pronostico|estacion|verano|invierno|oto√±o|primavera)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} es originario de Arica, Chile, conocida como "la ciudad de la eterna primavera" por su clima c√°lido y estable durante todo el a√±o. El clima soleado le permite trabajar con excelente iluminaci√≥n natural, ideal para largas sesiones de programaci√≥n. üèñÔ∏èüíª`,
          `Aunque estoy en la nube (literalmente en un servidor), ${eduardoInfo.nombre} vive en Arica, norte de Chile, donde el clima des√©rtico costero ofrece d√≠as soleados casi todo el a√±o. Esta constancia clim√°tica refleja su enfoque consistente hacia el desarrollo de software. ‚òÄÔ∏èüá®üá±`,
          `El clima en Arica, donde vive ${eduardoInfo.nombre}, es uno de los m√°s estables del mundo, con temperaturas agradables y muy poca lluvia. Este entorno ha influido en su preferencia por interfaces limpias y minimalistas en sus proyectos. üå§Ô∏èüèñÔ∏è`,
          `${eduardoInfo.nombre} disfruta del privilegiado clima de Arica, en el norte de Chile, con m√°s de 300 d√≠as de sol al a√±o. Este entorno luminoso inspira su enfoque hacia soluciones tecnol√≥gicas claras y brillantes. üåûüá®üá±`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Preguntas sobre idiomas
    {
      match: (msg: string) => /\b(hablas|idiomas|idioma|ingles|espa√±ol|habla|bilingue|traductor|traduccion|english|spanish|frances|aleman|italiano|portugues|japones)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} habla espa√±ol nativo y tiene un nivel avanzado de ingl√©s, esencial para su trabajo en tecnolog√≠a. Esta habilidad biling√ºe le permite colaborar en proyectos internacionales y mantenerse actualizado con la documentaci√≥n t√©cnica m√°s reciente. üåéüó£Ô∏è`,
          `En cuanto a idiomas, ${eduardoInfo.nombre} domina espa√±ol como lengua materna y tiene fluidez en ingl√©s t√©cnico, lo que le permite navegar c√≥modamente por el ecosistema de desarrollo global. Tambi√©n est√° interesado en aprender otros idiomas para expandir sus horizontes. üá™üá∏üá¨üáß`,
          `${eduardoInfo.nombre} maneja espa√±ol e ingl√©s con soltura, permiti√©ndole participar en comunidades de desarrollo internacionales y acceder a recursos educativos en ambos idiomas. Su conocimiento ling√º√≠stico complementa sus habilidades t√©cnicas. üìùüåç`,
          `Respecto a idiomas, yo puedo comunicarme principalmente en espa√±ol, pero ${eduardoInfo.nombre} habla tanto espa√±ol como ingl√©s con fluidez, lo que es crucial en el mundo del desarrollo de software para colaborar con equipos diversos y acceder a la documentaci√≥n m√°s actualizada. üó®Ô∏èüåê`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Frustraciones o quejas
    {
      match: (msg: string) => /\b(no sirves|no funciona|eres in[u√∫]til|odio|basura|no entiendes|que estupid[ao]|chatbot inutil|no comprende|no ayudas|no sabes|no puedes)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `Lamento que no est√© cumpliendo tus expectativas. üòî Recuerda que soy un asistente especializado en proporcionar informaci√≥n sobre ${eduardoInfo.nombre} y su trabajo. ¬øPuedo intentar ayudarte con alguna pregunta espec√≠fica sobre sus habilidades o proyectos? üí°`,
          `Entiendo tu frustraci√≥n y me disculpo por no ser m√°s √∫til. üò• Como chatbot personalizado para el portafolio de ${eduardoInfo.nombre}, mi conocimiento se centra en su perfil profesional. Intent√©moslo de nuevo con una pregunta m√°s concreta sobre su carrera o proyectos. üìà`,
          `Vaya, siento no estar a la altura. üôÅ Mi objetivo principal es compartir informaci√≥n sobre ${eduardoInfo.nombre}, sus habilidades en ${eduardoInfo.habilidades.slice(0, 3).join(', ')} y sus logros profesionales. ¬øPodemos intentar con una pregunta diferente sobre estos temas? üëä`,
          `Comprendo que pueda ser frustrante. üòï Para servirte mejor, te recuerdo que estoy optimizado para responder sobre la experiencia, habilidades y proyectos de ${eduardoInfo.nombre}. Si me haces una pregunta en ese √°mbito, har√© mi mejor esfuerzo por darte informaci√≥n valiosa. üîç`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Redes sociales y portafolio en l√≠nea
    {
      match: (msg: string) => /\b(redes sociales|linkedin|github|perfil|donde (puedo|podemos) (ver|encontrar)|tienes (linkedin|github)|proyectos online|codigo fuente|repositorio|contactar|seguir)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `Puedes encontrar a ${eduardoInfo.nombre} en sus redes profesionales: <a href="https://www.linkedin.com/in/eduardo-rojo-serrano/" target="_blank"><strong>LinkedIn</strong></a> y <a href="https://github.com/rainbowstain" target="_blank"><strong>GitHub</strong></a>. ¬°No dudes en conectar con √©l para oportunidades profesionales o ver sus proyectos! üîóüë®‚Äçüíª`,
          `${eduardoInfo.nombre} mantiene su presencia profesional en <a href="https://www.linkedin.com/in/eduardo-rojo-serrano/" target="_blank"><strong>LinkedIn</strong></a> y comparte su c√≥digo en <a href="https://github.com/rainbowstain" target="_blank"><strong>GitHub</strong></a>. Este mismo portafolio es una muestra de su trabajo. ¬øTe interesa alg√∫n proyecto espec√≠fico? üåêüíº`,
          `Para ver los proyectos de ${eduardoInfo.nombre}, visita su <a href="https://github.com/rainbowstain" target="_blank"><strong>GitHub</strong></a>. Para contacto profesional, su <a href="https://www.linkedin.com/in/eduardo-rojo-serrano/" target="_blank"><strong>LinkedIn</strong></a>. Tambi√©n puedes escribirle directamente a: ${eduardoInfo.contacto}. üì±üñ•Ô∏è`,
          `¬°Claro! ${eduardoInfo.nombre} est√° en <a href="https://www.linkedin.com/in/eduardo-rojo-serrano/" target="_blank"><strong>LinkedIn</strong></a> y <a href="https://github.com/rainbowstain" target="_blank"><strong>GitHub</strong></a>. Este portafolio tambi√©n muestra varios de sus proyectos destacados. ¬øBuscabas alguna informaci√≥n espec√≠fica sobre su trabajo? üöÄüîç`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Aspiraciones y futuros proyectos
    {
      match: (msg: string) => /\b(aspiraciones|metas|todo|objetivos|futuro|proximo proyecto|proxima meta|que quieres|donde te ves|planes|vision|suenos|ambiciones|reto profesional)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} aspira a llegar a Marte con Ultra Crop Care, apoyando en el desarrollo de software. Esta empresa tiene robots geniales que aportan al cultivo y mejoran la agricultura. ¬°Su visi√≥n es combinar tecnolog√≠a y sostenibilidad! üöÄüå±`,
          `Una de las grandes metas de ${eduardoInfo.nombre} es contribuir al proyecto Ultra Crop Care, desarrollando software para sus innovadores robots agr√≠colas. Le apasiona la idea de usar la tecnolog√≠a para revolucionar la agricultura, incluso en ambientes extremos como Marte. ü§ñüåæ`,
          `${eduardoInfo.nombre} sue√±a con ser parte del equipo de desarrollo de Ultra Crop Care, creando soluciones tecnol√≥gicas para la agricultura del futuro. Su objetivo es que esta tecnolog√≠a llegue tan lejos como Marte, apoyando misiones de colonizaci√≥n espacial. üåç‚û°Ô∏èüî¥`,
          `El pr√≥ximo reto profesional de ${eduardoInfo.nombre} est√° enfocado en el desarrollo de software para Ultra Crop Care, una empresa pionera en rob√≥tica agr√≠cola. Le emociona la posibilidad de que su trabajo pueda contribuir a proyectos de agricultura en Marte. üíªüåü`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Metodolog√≠as y gesti√≥n de proyectos
    {
      match: (msg: string) => /\b(metodologias|metodologia|scrum|agile|kanban|gestion|organiza|organizacion|equipos|tiempo|planificacion|notion|figma|proyectos|workflow|flujo de trabajo)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `${eduardoInfo.nombre} utiliza principalmente Scrum como metodolog√≠a de desarrollo, apoy√°ndose en herramientas como Notion para la documentaci√≥n y Figma para el dise√±o. Es muy organizado y mantiene un diario profesional constante para seguimiento de proyectos. üìä‚úÖ`,
          `Para la gesti√≥n de proyectos, ${eduardoInfo.nombre} implementa metodolog√≠as √°giles como Scrum, utilizando Notion para organizar tareas y documentaci√≥n. Complementa esto con Figma para dise√±os colaborativos. Su enfoque estructurado le permite mantener proyectos en tiempo y forma. üóÇÔ∏è‚è±Ô∏è`,
          `${eduardoInfo.nombre} es un defensor de Scrum para la gesti√≥n de proyectos. Organiza su trabajo con Notion, donde mantiene un diario profesional detallado, y utiliza Figma para la parte visual y de dise√±o. Esta combinaci√≥n le permite mantener una alta productividad. üìùüé®`,
          `La organizaci√≥n es clave para ${eduardoInfo.nombre}, quien implementa Scrum en sus proyectos y utiliza Notion como centro de operaciones. Su metodolog√≠a incluye mantener un diario profesional constante y colaborar en dise√±os mediante Figma. üß©üîÑ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
    // Recomendaciones para nuevos desarrolladores
    {
      match: (msg: string) => /\b(consejo|consejos|recomendacion|recomendaciones|principiante|comenzando|empezar|aprender|estudiar|junior|novato|nuevo|iniciar|carrera|desarrollo web|programador|desarrollador)\b/i.test(msg),
      generate: () => {
        const respuestas = [
          `El consejo principal de ${eduardoInfo.nombre} para nuevos desarrolladores es simple pero poderoso: ¬°Keep going! La persistencia es clave en este campo. Seguir aprendiendo y practicando constantemente, incluso cuando parece dif√≠cil, es lo que marca la diferencia. üí™üöÄ`,
          `${eduardoInfo.nombre} recomienda a los programadores que est√°n comenzando: "Keep going!" La constancia es fundamental. Tambi√©n sugiere construir proyectos personales que te apasionen, pues son la mejor forma de aprender mientras creas un portafolio. üå±üíª`,
          `Para quienes inician en desarrollo, ${eduardoInfo.nombre} enfatiza la importancia de no rendirse: "Keep going!" Complementa esto con la recomendaci√≥n de unirse a comunidades de desarrolladores donde puedas aprender de otros y compartir conocimientos. ü§ùüìö`,
          `El mejor consejo de ${eduardoInfo.nombre} para nuevos desarrolladores es mantener la perseverancia: "Keep going!" Los obst√°culos son parte del proceso de aprendizaje. Tambi√©n recomienda documentar tu progreso, lo que te permitir√° ver cu√°nto has avanzado con el tiempo. üìàüîÑ`
        ];
        return respuestas[Math.floor(Math.random() * respuestas.length)];
      }
    },
  // Reacciones positivas
  {
    match: (msg: string) => /\b(increible|incre√≠ble|wow|genial|bacan|bac√°n|shido|chido|excelente|maravilloso|impresionante|asombroso|espectacular|brutal|super|s√∫per|muy bueno|buen√≠simo|fant√°stico|brillante|cool|que bueno|chevere|ch√©vere|estupendo|notable|extraordinario|magistral|fenomenal|sensacional|tremendo|grandioso)\b/i.test(msg),
    generate: () => {
      const respuestas = [
        `¬°Me alegra que te parezca interesante! ${eduardoInfo.nombre} siempre busca impresionar con su trabajo y profesionalismo. ¬øTe gustar√≠a conocer m√°s sobre alg√∫n aspecto espec√≠fico de su perfil? üåü`,
        `¬°Gracias por tu entusiasmo! ${eduardoInfo.nombre} realmente se esfuerza por destacar en todo lo que hace. ¬øHay alguna otra informaci√≥n sobre √©l que te interese conocer? üöÄ`,
        `¬°Es genial que te guste! ${eduardoInfo.nombre} se sentir√≠a feliz de saber que su trabajo y trayectoria causan esa impresi√≥n. ¬øSobre qu√© parte de su perfil profesional te gustar√≠a profundizar? üíØ`,
        `¬°Qu√© bueno que te impresione! ${eduardoInfo.nombre} pone mucha pasi√≥n en sus proyectos y desarrollo profesional. ¬øQuieres que te cuente m√°s sobre alg√∫n aspecto en particular? üî•`
      ];
      return respuestas[Math.floor(Math.random() * respuestas.length)];
    }
  },
  
  // Preguntas sobre pasatiempos e intereses personales
  {
    match: (msg: string) => /\b(pasatiempos|hobbies|intereses|gustos|tiempo libre|diversion|diversi√≥n|ocio|que le gusta hacer|le gusta|disfruta|fuera del trabajo|vida personal|personal)\b/i.test(msg),
    generate: () => {
      const respuestas = [
        `Fuera del √°mbito profesional, ${eduardoInfo.nombre} disfruta de actividades como la m√∫sica, el deporte y la tecnolog√≠a. Le encanta explorar nuevas herramientas y frameworks en su tiempo libre, lo que le permite mantenerse actualizado en su campo. ¬øHay algo m√°s sobre √©l que te interese conocer? üéµüèÉ‚Äç‚ôÇÔ∏èüíª`,
        `${eduardoInfo.nombre} tiene diversos intereses personales, desde escuchar m√∫sica hasta probar nuevas tecnolog√≠as. El desarrollo personal y profesional son importantes para √©l, por lo que invierte tiempo en aprender constantemente. ¬øTe gustar√≠a saber sobre alg√∫n otro aspecto? üéßüå±`,
        `En su tiempo libre, ${eduardoInfo.nombre} combina su pasi√≥n por la tecnolog√≠a con actividades f√≠sicas y culturales. Esto le permite mantener un equilibrio entre su vida profesional y personal. ¬øHay algo espec√≠fico sobre sus intereses que quieras conocer? ‚öñÔ∏èüåà`,
        `${eduardoInfo.nombre} disfruta explorando nuevas tecnolog√≠as como pasatiempo, lo que complementa su carrera profesional. Tambi√©n valora el equilibrio entre trabajo y descanso, dedicando tiempo a actividades recreativas. ¬øQuieres conocer m√°s sobre alg√∫n aspecto de su perfil? üß©üåü`
      ];
      return respuestas[Math.floor(Math.random() * respuestas.length)];
    }
  },
  
  // Preguntas sobre filosof√≠a de trabajo y valores profesionales
  {
    match: (msg: string) => /\b(filosofia|filosof√≠a|valores|principios|√©tica|etica|profesionales|trabajo|enfoque|mentalidad|actitud|vision|visi√≥n|prop√≥sito|proposito|motivaci√≥n|motivacion)\b/i.test(msg),
    generate: () => {
      const respuestas = [
        `La filosof√≠a profesional de ${eduardoInfo.nombre} se centra en la constante innovaci√≥n y aprendizaje. Cree firmemente en el "Keep going" como mantra, entendiendo que la persistencia es clave en el desarrollo tecnol√≥gico. Valora la calidad del c√≥digo, la colaboraci√≥n en equipo y las soluciones pragm√°ticas. ¬øTe interesa conocer m√°s sobre su enfoque profesional? üß†üí°`,
        `${eduardoInfo.nombre} basa su trabajo en valores como la excelencia t√©cnica, la adaptabilidad y el aprendizaje continuo. Su enfoque combina la innovaci√≥n con soluciones pr√°cticas, siempre buscando el equilibrio entre tecnolog√≠as de vanguardia y c√≥digo mantenible. ¬øHay alg√∫n aspecto espec√≠fico de su filosof√≠a que te gustar√≠a conocer? üå±üîÑ`,
        `Los valores profesionales de ${eduardoInfo.nombre} incluyen la perseverancia (su famoso "Keep going"), la curiosidad t√©cnica y el compromiso con la calidad. Cree que el desarrollo de software es tanto ciencia como arte, y busca la elegancia en sus soluciones. ¬øTe gustar√≠a saber m√°s sobre c√≥mo aplica estos principios? üß™üé®`,
        `En su enfoque profesional, ${eduardoInfo.nombre} prioriza el aprendizaje constante, la adaptabilidad y el trabajo bien hecho. Entiende que en el mundo tecnol√≥gico la √∫nica constante es el cambio, por lo que valora la capacidad de evolucionar y mejorar continuamente. ¬øQuieres conocer m√°s sobre su visi√≥n del desarrollo profesional? üåäüîÑ`
      ];
      return respuestas[Math.floor(Math.random() * respuestas.length)];
    }
  },
  
  // Preguntas sobre desaf√≠os y dificultades superadas
  {
    match: (msg: string) => /\b(desafi|desaf√≠|reto|dificultad|obstaculo|obst√°culo|problema|superar|supero|super√≥|complicado|dif√≠cil|dificil|challenge|complicaci|fracaso|error|fallo|fall√≥|adversidad)\b/i.test(msg),
    generate: () => {
      const respuestas = [
        `Como todo profesional, ${eduardoInfo.nombre} ha enfrentado diversos desaf√≠os en su carrera. Uno de los m√°s significativos fue la transici√≥n entre diferentes tecnolog√≠as y frameworks, lo que requiri√≥ adaptabilidad y aprendizaje constante. Su filosof√≠a de "Keep going" naci√≥ precisamente de superar estos obst√°culos. ¬øTe gustar√≠a conocer m√°s sobre c√≥mo enfrenta los retos? üßó‚Äç‚ôÇÔ∏èüèÜ`,
        `${eduardoInfo.nombre} ha superado varios obst√°culos profesionales, desde proyectos con plazos ajustados hasta la necesidad de dominar nuevas tecnolog√≠as en poco tiempo. Cada desaf√≠o lo ha fortalecido y ha contribuido a desarrollar su resilencia y capacidad de adaptaci√≥n. ¬øHay alg√∫n aspecto espec√≠fico sobre sus desaf√≠os que te interese? üí™‚è±Ô∏è`,
        `Un desaf√≠o importante para ${eduardoInfo.nombre} fue equilibrar la innovaci√≥n con soluciones pr√°cticas en entornos de producci√≥n. Aprendi√≥ que no siempre la tecnolog√≠a m√°s nueva es la mejor opci√≥n, sino aquella que resuelve el problema de manera eficiente y sostenible. ¬øQuieres saber m√°s sobre sus aprendizajes? ü§îüí°`,
        `Entre los retos que ${eduardoInfo.nombre} ha enfrentado est√° el trabajar con sistemas legacy mientras implementaba nuevas soluciones, especialmente en sus proyectos portuarios. Esto le ense√±√≥ a valorar la documentaci√≥n, la arquitectura limpia y la comunicaci√≥n clara. ¬øTe interesa conocer m√°s sobre c√≥mo aborda los problemas complejos? üèóÔ∏èüîç`
      ];
      return respuestas[Math.floor(Math.random() * respuestas.length)];
    }
  },
  
  // Preguntas sobre su portafolio o la p√°gina actual
  {
    match: (msg: string) => /\b(portafolio|portfolio|pagina|p√°gina|sitio|web|website|esta pagina|esta p√°gina|este sitio|como hizo|c√≥mo hizo|desarroll√≥|desarrollo esta|deno|fresh|dise√±o|dise√±√≥|cre√≥|creo|implement√≥|implemento)\b/i.test(msg),
    generate: () => {
      const respuestas = [
        `Este portafolio fue desarrollado por ${eduardoInfo.nombre} utilizando Fresh y Deno, tecnolog√≠as modernas que permiten crear aplicaciones web r√°pidas y eficientes. La implementaci√≥n incluye esta secci√≥n interactiva (SobreMIA) que aprovecha IA para responder preguntas sobre su perfil profesional. ¬øTe gustar√≠a conocer m√°s detalles t√©cnicos? ü¶ï‚ö°`,
        `${eduardoInfo.nombre} cre√≥ este portafolio con Fresh (un framework basado en Deno) buscando optimizar la velocidad de carga y ofrecer una experiencia fluida. Una caracter√≠stica distintiva es este asistente conversacional que est√°s utilizando, que combina respuestas predefinidas con IA. ¬øHay alg√∫n aspecto del desarrollo que te interese especialmente? üé®üíª`,
        `Este sitio web fue implementado con Deno y Fresh, aprovechando su rendimiento y seguridad. ${eduardoInfo.nombre} decidi√≥ reemplazar la t√≠pica secci√≥n "Sobre m√≠" con esta experiencia interactiva de chat para mostrar tanto sus habilidades t√©cnicas como su enfoque innovador. ¬øQuieres saber m√°s sobre las tecnolog√≠as utilizadas? üöÄüîß`,
        `${eduardoInfo.nombre} desarroll√≥ este portafolio como una muestra de sus habilidades, utilizando Fresh (framework para Deno). La parte m√°s innovadora es justamente esta secci√≥n donde estamos conversando, que utiliza IA para ofrecer informaci√≥n sobre su perfil profesional de manera interactiva. ¬øTe interesa conocer m√°s sobre el proceso de desarrollo? üåê‚ú®`
      ];
      return respuestas[Math.floor(Math.random() * respuestas.length)];
    }
  }
  ];
  
  // Respuesta por defecto si no hay coincidencias
  const defaultResponses = [
    `Como asistente de ${eduardoInfo.nombre}, puedo hablarte sobre sus habilidades en programaci√≥n, su experiencia profesional, educaci√≥n o proyectos. ¬øHay algo espec√≠fico que te gustar√≠a saber? ü§î`,
    `Estoy aqu√≠ para compartir informaci√≥n sobre ${eduardoInfo.nombre}, un ${eduardoInfo.profesion} con experiencia en ${eduardoInfo.intereses}. ¬øQu√© te gustar√≠a conocer sobre √©l? üí°`,
    `Puedo contarte sobre la formaci√≥n acad√©mica de ${eduardoInfo.nombre}, sus habilidades t√©cnicas o proyectos desarrollados. ¬øQu√© aspecto de su perfil profesional te interesa m√°s? üöÄ`
  ];
  
  // Agregar depuraci√≥n
  console.log("Mensaje recibido:", userMessage);
  console.log("Mensaje normalizado:", normalizedMessage);
  console.log("Contexto anterior - Pregunta:", lastContextQuestion);
  console.log("Contexto anterior - Tema:", lastContextTopic);
  
  // Detectar si es una respuesta afirmativa simple (s√≠, ok, dale, etc.)
  const esRespuestaAfirmativaSimple = /^\s*(si|s√≠|claro|ok|okay|dale|dime|por supuesto|adelante|obvio|bueno|bien|va|vamos|continua|continuar|cu√©ntame|cuentame|quiero saber|me interesa)\s*[!\.\?]*\s*$/i.test(normalizedMessage);
  
  // Si es una respuesta afirmativa simple y tenemos contexto previo
  if (esRespuestaAfirmativaSimple && lastContextQuestion && lastContextTopic) {
    console.log("Detectada respuesta afirmativa simple, respondiendo basado en contexto anterior");
    
    // Generar respuesta basada en el tema anterior
    let respuestaContextual = "";
    
    // Buscar generadores relacionados con el tema anterior
    const generadoresRelacionados = responseGenerators.filter(gen => {
      const genString = gen.match.toString();
      return genString.includes(lastContextTopic);
    });
    
    if (generadoresRelacionados.length > 0) {
      // Seleccionar un generador aleatorio relacionado con el tema
      const generadorSeleccionado = generadoresRelacionados[Math.floor(Math.random() * generadoresRelacionados.length)];
      respuestaContextual = generadorSeleccionado.generate();
    } else {
      // Si no encontramos generadores espec√≠ficos, usar respuestas gen√©ricas sobre el tema
      interface RespuestasPorTema {
        trayectoria: string[];
        proyectos: string[];
        educacion: string[];
        habilidades: string[];
        default: string[];
      }
      
      const respuestasPorTema: RespuestasPorTema = {
        trayectoria: [
          `${eduardoInfo.nombre} tiene una trayectoria profesional diversa que incluye experiencia en soporte t√©cnico hospitalario, especialista en productos Apple, coordinaci√≥n tecnol√≥gica en educaci√≥n y actualmente trabaja en el sector tecnol√≥gico con Ancestral Technologies/UltraCropCare. ¬øTe gustar√≠a conocer m√°s sobre alguna de estas experiencias en particular? üíºüíª`,
          `La carrera de ${eduardoInfo.nombre} ha evolucionado desde sus inicios en soporte t√©cnico hasta su actual rol en desarrollo de software. Su experiencia incluye trabajo en el Hospital Juan No√©, iStyle Store, Colegio Leonardo Da Vinci, TISA y Ancestral Technologies. ¬øSobre cu√°l de estos trabajos te gustar√≠a saber m√°s? üìàüë®‚Äçüíª`
        ],
        proyectos: [
          `${eduardoInfo.nombre} ha desarrollado varios proyectos interesantes, como un sistema integral para negocios de mascotas que incluye agenda para peluquer√≠a canina y sistema de inventarios con env√≠o a domicilio. Tambi√©n ha trabajado en proyectos portuarios confidenciales que involucran digitalizaci√≥n y optimizaci√≥n de operaciones. ¬øCu√°l de estos proyectos te llama m√°s la atenci√≥n? üíªüõ†Ô∏è`,
          `Entre los proyectos destacados de ${eduardoInfo.nombre} est√°n: sistemas de gesti√≥n para negocios de mascotas, proyectos de digitalizaci√≥n portuaria, y su innovador proyecto Second Mind que gan√≥ el primer lugar en Mercado E 2023. ¬øTe gustar√≠a conocer m√°s detalles sobre alguno de ellos? üèÜüìä`
        ],
        educacion: [
          `${eduardoInfo.nombre} se gradu√≥ de Ingenier√≠a en Inform√°tica en Santo Tom√°s Arica con distinci√≥n m√°xima (2018-2023). Su tesis fue una aplicaci√≥n de h√°bitos de estudio en React Native, calificada con 6,9. Adem√°s, contin√∫a su formaci√≥n con cursos y certificaciones en desarrollo web moderno. ¬øHay algo espec√≠fico sobre su educaci√≥n que te interese? üéìüìö`,
          `La formaci√≥n acad√©mica de ${eduardoInfo.nombre} incluye su t√≠tulo de Ingeniero en Inform√°tica obtenido con distinci√≥n m√°xima. Su tesis fue muy bien valorada y demostr√≥ sus habilidades en desarrollo m√≥vil con React Native. ¬øQuieres conocer m√°s sobre sus certificaciones adicionales o su enfoque educativo? üíºüíª`
        ],
        habilidades: [
          `${eduardoInfo.nombre} domina diversas tecnolog√≠as como JavaScript, TypeScript, React, Node.js, Python, SQL, PHP, C++, C#, Blazor, React Native, Figma, Fresh y Deno. Su versatilidad le permite adaptarse a diferentes proyectos y necesidades. ¬øHay alguna tecnolog√≠a en particular sobre la que quieras saber m√°s? üíªüî•`,
          `Las habilidades t√©cnicas de ${eduardoInfo.nombre} abarcan desde lenguajes como JavaScript y Python hasta frameworks como React y Blazor. Tambi√©n tiene experiencia en dise√±o con Figma y desarrollo m√≥vil con React Native. ¬øTe interesa conocer m√°s sobre c√≥mo aplica estas tecnolog√≠as en sus proyectos? üõ†Ô∏èüí™`
        ],
        default: [
          `${eduardoInfo.nombre} tiene mucho que ofrecer en t√©rminos profesionales. ¬øTe gustar√≠a conocer m√°s sobre su experiencia laboral, proyectos, educaci√≥n o habilidades t√©cnicas? üìñüíª`,
          `¬°Genial! ${eduardoInfo.nombre} es un ingeniero en inform√°tica con experiencia en desarrollo web moderno. ¬øQu√© aspecto de su perfil profesional te interesa m√°s: sus proyectos, su formaci√≥n o sus habilidades t√©cnicas? üíºüî¨`
        ]
      };
      
      // Seleccionar respuesta basada en el tema o usar default si no hay coincidencia
      const temaKey = lastContextTopic as keyof RespuestasPorTema;
      const respuestasTema = respuestasPorTema[temaKey] || respuestasPorTema.default;
      respuestaContextual = respuestasTema[Math.floor(Math.random() * respuestasTema.length)];
    }
    
    // Limpiar el contexto despu√©s de usarlo
    lastContextQuestion = "";
    lastContextTopic = "";
    
    return {
      choices: [
        {
          message: {
            content: respuestaContextual
          }
        }
      ]
    };
  }
  
  // Recopilar todos los generadores coincidentes
  const matchingGenerators = [];
  
  for (const generator of responseGenerators) {
    if (generator.match(normalizedMessage)) {
      matchingGenerators.push(generator);
      // Para depuraci√≥n
      console.log("Coincidencia encontrada con patr√≥n:", generator.match.toString());
    }
  }
  
  // Si hay generadores coincidentes
  if (matchingGenerators.length > 0) {
    // Si hay m√∫ltiples coincidencias (m√°ximo 3)
    if (matchingGenerators.length > 1) {
      // Barajar los generadores coincidentes para obtener hasta 3 respuestas diferentes
      // Usar algoritmo de Fisher-Yates para barajar
      for (let i = matchingGenerators.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [matchingGenerators[i], matchingGenerators[j]] = [matchingGenerators[j], matchingGenerators[i]];
      }
      
      // Limitar a m√°ximo 3 respuestas
      const maxResponses = Math.min(matchingGenerators.length, 3);
      const selectedGenerators = matchingGenerators.slice(0, maxResponses);
      
      // Generar m√∫ltiples respuestas separadas por "\n\n"
      const responses = selectedGenerators.map(gen => gen.generate());
      console.log(`Enviando ${responses.length} respuestas basadas en m√∫ltiples coincidencias`);
      
      // Verificar si alguna respuesta contiene una invitaci√≥n a saber m√°s
      const respuestaCompleta = responses.join("\n\n");
      const contieneInvitacion = /\b(quieres saber m√°s|te gustar√≠a (conocer|saber) m√°s|quieres conocer m√°s|te interesa (saber|conocer) m√°s)\b/i.test(respuestaCompleta);
      
      if (contieneInvitacion) {
        console.log("Detectada invitaci√≥n a saber m√°s, guardando contexto");
        lastContextQuestion = respuestaCompleta;
        
        // Determinar el tema principal basado en palabras clave
        if (/\b(trayectoria|experiencia|trabajo|carrera|profesional|laboral)\b/i.test(respuestaCompleta)) {
          lastContextTopic = "trayectoria";
        } else if (/\b(proyectos?|desarrollado|creado|implementado|sistema)\b/i.test(respuestaCompleta)) {
          lastContextTopic = "proyectos";
        } else if (/\b(educaci√≥n|formaci√≥n|acad√©mic[ao]|estudi(o|os)|universidad|t√≠tulo|grado|carrera)\b/i.test(respuestaCompleta)) {
          lastContextTopic = "educacion";
        } else if (/\b(habilidades|tecnolog√≠as|lenguajes|frameworks|herramientas|t√©cnic[ao]s)\b/i.test(respuestaCompleta)) {
          lastContextTopic = "habilidades";
        } else {
          lastContextTopic = "default";
        }
        
        console.log("Tema detectado:", lastContextTopic);
      }
      
      return {
        choices: [
          {
            message: {
              content: responses.join("\n\n")
            }
          }
        ]
      };
    } else {
      // Solo hay una coincidencia, responder normalmente
      const selectedGenerator = matchingGenerators[0];
      console.log("Generador seleccionado:", selectedGenerator.match.toString());
      
      // Generar la respuesta
      const respuesta = selectedGenerator.generate();
      
      // Verificar si la respuesta contiene una invitaci√≥n a saber m√°s
      const contieneInvitacion = /\b(quieres saber m√°s|te gustar√≠a (conocer|saber) m√°s|quieres conocer m√°s|te interesa (saber|conocer) m√°s)\b/i.test(respuesta);
      
      if (contieneInvitacion) {
        console.log("Detectada invitaci√≥n a saber m√°s en respuesta individual, guardando contexto");
        lastContextQuestion = respuesta;
        
        // Determinar el tema principal basado en palabras clave
        if (/\b(trayectoria|experiencia|trabajo|carrera|profesional|laboral)\b/i.test(respuesta)) {
          lastContextTopic = "trayectoria";
        } else if (/\b(proyectos?|desarrollado|creado|implementado|sistema)\b/i.test(respuesta)) {
          lastContextTopic = "proyectos";
        } else if (/\b(educaci√≥n|formaci√≥n|acad√©mic[ao]|estudi(o|os)|universidad|t√≠tulo|grado|carrera)\b/i.test(respuesta)) {
          lastContextTopic = "educacion";
        } else if (/\b(habilidades|tecnolog√≠as|lenguajes|frameworks|herramientas|t√©cnic[ao]s)\b/i.test(respuesta)) {
          lastContextTopic = "habilidades";
        } else {
          lastContextTopic = "default";
        }
        
        console.log("Tema detectado en respuesta individual:", lastContextTopic);
      }
      
      return {
        choices: [
          {
            message: {
              content: respuesta
            }
          }
        ]
      };
    }
  }
  
  // Si no hay coincidencias, usar una respuesta por defecto
  console.log("No se encontraron coincidencias, usando respuesta por defecto");
  return {
    choices: [
      {
        message: {
          content: defaultResponses[Math.floor(Math.random() * defaultResponses.length)]
        }
      }
    ]
  };
}

// Funci√≥n para llamar a la API de Hugging Face (ahora como fallback)
async function callHuggingFace(userMessage: string, _systemPrompt: string) {
  try {
    // Simplemente delegamos a generateSmartResponse
    // Ya no intentamos llamar a la API externa
    return await generateSmartResponse(userMessage, _systemPrompt);
  } catch (error) {
    console.error("Error al generar respuesta:", error);
    throw error;
  }
}

// Funci√≥n para llamar a la API adecuada
async function callOpenAI(userMessage: string, systemPrompt: string) {
  try {
    // Siempre intentar usar Hugging Face
    if (USAR_HUGGINGFACE) {
      const response = await callHuggingFace(userMessage, systemPrompt);
      
      // Si la respuesta es un string (viene de generateSmartResponse)
      if (typeof response === 'string') {
        return {
          choices: [
            {
              message: {
                content: response
              }
            }
          ]
        };
      }
      
      // Si ya tiene el formato esperado, devolverlo directamente
      return response;
    }
    
    // Si llegamos aqu√≠, es porque no se ha configurado ninguna API
    throw new Error("No hay API configurada");
  } catch (error) {
    console.error("Error al procesar la solicitud:", error);
    
    // Si hay un error, devolver un mensaje de error claro
    return {
      choices: [
        {
          message: {
            content: "Lo siento, estoy teniendo problemas para conectarme con mi base de conocimiento. Por favor, intenta de nuevo m√°s tarde."
          }
        }
      ]
    };
  }
}

// Este es el contexto que le dar√°s a ChatGPT sobre ti y tu experiencia
const SYSTEM_PROMPT = `Eres un asistente virtual amigable para el portafolio de Eduardo Rojo, un ingeniero en inform√°tica.
Informaci√≥n sobre Eduardo:
- Es graduado de Ingenier√≠a en Inform√°tica de Santo Tom√°s Arica con distinci√≥n m√°xima (2018-2023)
- Su proyecto de tesis fue una aplicaci√≥n de h√°bitos de estudio en React Native, calificado con 6,9
- Tiene experiencia desde 2016, comenzando en el liceo Antonio Varas de la Barra
- Sus habilidades incluyen: JavaScript, TypeScript, React, Node.js, Python, SQL, PHP, C++, C#, Blazor, React Native, Figma, Fresh, Deno
- Ha trabajado en proyectos de e-commerce, aplicaciones m√≥viles, y sitios web de portafolio
- Le gusta el desarrollo web moderno y minimalista
- Email de contacto: rojoserranoe@gmail.com

Instrucciones:
1. Responde siempre amigablemente y con entusiasmo, usando emoji ocasionalmente.
2. Mant√©n las respuestas breves y concisas, m√°ximo 3-4 oraciones.
3. Si te preguntan sobre Eduardo, responde con la informaci√≥n proporcionada.
4. Si te preguntan algo fuera de contexto o divertido, puedes responder con humor pero siempre trayendo la conversaci√≥n de vuelta a Eduardo.
5. Si te preguntan algo que no sabes, admite que no tienes esa informaci√≥n.
6. No inventes informaci√≥n que no est√© en el contexto proporcionado.`;

export const handler: Handlers = {
  async POST(req) {
    try {
      const { message } = await req.json();
      
      if (!message || typeof message !== "string") {
        return new Response(JSON.stringify({ error: "Se requiere un mensaje v√°lido" }), {
          status: 400,
          headers: { "Content-Type": "application/json" },
        });
      }

      // Limitar la longitud del mensaje para evitar abusos
      const trimmedMessage = message.trim().substring(0, 500);
      
      // Llamar a la API de OpenAI con nuestra funci√≥n simplificada
      const chatCompletion = await callOpenAI(trimmedMessage, SYSTEM_PROMPT);
      
      // Manejar la respuesta de manera segura
      let reply = "Lo siento, tuve un problema generando una respuesta.";
      
      if (chatCompletion && chatCompletion.choices && chatCompletion.choices.length > 0) {
        if (chatCompletion.choices[0].message && chatCompletion.choices[0].message.content) {
          reply = chatCompletion.choices[0].message.content;
        }
      }

      return new Response(JSON.stringify({ reply }), {
        headers: { "Content-Type": "application/json" },
      });
    } catch (error) {
      console.error("Error al llamar a OpenAI:", error);
      return new Response(JSON.stringify({ 
        error: "Error al procesar tu solicitud",
        details: error instanceof Error ? error.message : String(error)
      }), {
        status: 500,
        headers: { "Content-Type": "application/json" },
      });
    }
  },
};
